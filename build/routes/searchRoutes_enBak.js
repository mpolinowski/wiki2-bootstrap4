var express=require("express"),searchRouter=express.Router(),elasticsearch=require("elasticsearch"),connectionString="localhost:9200",client=new elasticsearch.Client({host:connectionString,log:"trace"}),_index="wiki",_type="article";searchRouter.route("/").get(function(e,t){t.render("Search",{title:"INSTAR Wiki Search"})}),searchRouter.route("/Results").get(function(e,t){var r=e.query.agg_value,s=e.query.agg_field,i={};i[s]=r,client.search({index:_index,type:_type,body:{query:{filtered:{query:{multi_match:{query:e.query.q,fields:["title^100","tags^50","abstract^20","description^10","models^5","chapter^5","title2^5"],fuzziness:1}},filter:{term:s?i:void 0}}},aggs:{title:{terms:{field:"title.raw"}},tags:{terms:{field:"tags.raw"}},abstract:{terms:{field:"abstract.raw"}},title2:{terms:{field:"title2.raw"}},chapter:{terms:{field:"chapter.raw"}}},suggest:{text:e.query.q,simple_phrase:{phrase:{field:"title",size:1,real_word_error_likelihood:.95,max_errors:.5,gram_size:2,direct_generator:[{field:"title",suggest_mode:"always",min_word_length:1}],highlight:{pre_tag:"<b><em>",post_tag:"</em></b>"}}}}}}).then(function(r){t.render("Search_Results",{title:"INSTAR Wiki Search Results",response:r,query:e.query.q})},function(e){console.trace(e.message),t.render("Search_Results",{title:"INSTAR Wiki Search Results",response:e.message})})}),module.exports=searchRouter;